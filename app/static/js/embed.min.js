(function () {
  // Tạo nút "Chat with us"
  const chatbotButton = document.createElement('button');
  chatbotButton.innerText = 'Chat with us';
  chatbotButton.style.position = 'fixed';
  chatbotButton.style.bottom = '20px';
  chatbotButton.style.right = '20px';
  chatbotButton.style.backgroundColor = '#007bff';
  chatbotButton.style.color = 'white';
  chatbotButton.style.border = 'none';
  chatbotButton.style.borderRadius = '50px';
  chatbotButton.style.padding = '10px 20px';
  chatbotButton.style.cursor = 'pointer';
  chatbotButton.style.zIndex = '1000';
  document.body.appendChild(chatbotButton);

  // Tạo khung chứa iframe chatbot
  const chatbotContainer = document.createElement('div');
  chatbotContainer.style.position = 'fixed';
  chatbotContainer.style.bottom = '70px';
  chatbotContainer.style.right = '20px';
  chatbotContainer.style.width = '400px';
  chatbotContainer.style.height = '600px';
  chatbotContainer.style.zIndex = '1000';
  chatbotContainer.style.display = 'none'; // Bắt đầu ẩn
  chatbotContainer.style.borderRadius = '20px'; // Bo tròn 4 góc
  chatbotContainer.style.overflow = 'hidden'; // Đảm bảo nội dung không tràn ra ngoài
  document.body.appendChild(chatbotContainer);
  let iframeCreated = false; // Biến để kiểm tra iframe đã được tạo hay chưa

  // Sự kiện bật/tắt chatbot khi nhấn nút
  chatbotButton.onclick = () => {
    if (chatbotContainer.style.display === 'none') {
      chatbotContainer.style.display = 'block';

      // Chỉ tạo iframe khi lần đầu bấm nút
      if (!iframeCreated && window.ChatbotConfig) {
        const e = window.ChatbotConfig;
        const iframe = document.createElement('iframe');
        iframe.src = e.baseUrl + "/chatbot?token=" + e.token;
        iframe.style.width = '100%';
        iframe.style.height = '100%';
        iframe.style.border = 'none';
        chatbotContainer.appendChild(iframe);
        iframeCreated = true; // Đánh dấu đã tạo iframe
      } else if (!window.ChatbotConfig) {
        console.error("ChatbotConfig không được định nghĩa");
      }
    } else {
      chatbotContainer.style.display = 'none';
    }
  };
})();
